<% content_for(:page_title, "All Members")%>

<!-- Top bar -->
<div class="flex justify-between items-end mb-3">

  <!-- Left side: export buttons (admins only) -->
  <% if current_user.admin? %>
    <div class="flex gap-3">
      <!-- Export ALL Members -->
      <div class="relative group inline-block">
        <label class="text-xs invisible h-[20px] leading-none">Export</label>
        <%= link_to "Export ALL Members To Excel >",
            members_path(format: "xlsx",
                         state: params[:state],
                         city: params[:city],
                         created_at: params[:created_at],
                         club_id: params[:club_id]),
            class: "border border-blue-900 font-bold text-blue-900 text-sm px-3 py-2 rounded hover:bg-blue-100 inline-block whitespace-nowrap" %>
        <div class="absolute bottom-full mb-1 hidden group-hover:block bg-gray-800 text-white text-xs rounded py-1 px-2 whitespace-nowrap">
          Basic data export, use filter if applicable
        </div>
      </div>

      <!-- Active Club Members Export -->
      <div class="relative group inline-block">
        <label class="text-xs invisible h-[20px] leading-none">Export</label>
        <%= link_to "Active Club Members Export >",
            active_club_members_path(format: "csv", club_id: params[:club_id]),
            class: "border border-green-700 font-bold text-green-700 text-sm px-3 py-2 rounded hover:bg-green-100 inline-block whitespace-nowrap" %>
        <div class="absolute bottom-full mb-1 hidden group-hover:block bg-gray-800 text-white text-xs rounded py-1 px-2 whitespace-nowrap">
          Only active clubs and their members to CSV
        </div>
      </div>
    </div>
  <% end %>

  <!-- Right side: Club filter (visible to all users) -->
  <div>
    <%= form_with url: members_path, method: :get, local: true, class: "inline-flex items-end gap-2" do %>
      <div>
        <label class="block text-xs text-gray-600 mb-1">Club</label>
        <%= select_tag :club_id,
          options_for_select([["All clubs", ""]] + @clubs, params[:club_id]),
          class: "border px-3 py-2 rounded",
          onchange: "this.form.submit();" %>
      </div>

      <!-- preserve other filters -->
      <%= hidden_field_tag :state,      params[:state] if params[:state].present? %>
      <%= hidden_field_tag :city,       params[:city] if params[:city].present? %>
      <%= hidden_field_tag :created_at, params[:created_at] if params[:created_at].present? %>

      <%= link_to "Clear", members_path, class: "text-sm text-gray-600 underline ml-2" %>
    <% end %>
  </div>

</div>



<div id="members">
  <br>
    <% if @members.any? %>

    <div class="relative overflow-x-auto">
    <table class="table-auto w-full text-left rtl:text-right">
        <thead class="bg-gray-200 border-b text-gray-500 font-light text-xs ">
             <tr>
                <th scope="col" class="px-6 py-1">
                    First Name
                </th>
                <th scope="col" class="px-6 py-1">
                    Last Name
                </th>
                <th scope="col" class="px-6 py-1">
                    City
                </th>
                <th scope="col" class="px-6 py-1 ">
                    State
                 </th>
                 <th scope="col" class="px-6 py-1">
                    Club
                </th>
                <th scope="col" class="px-6 py-1">
                    Email
                </th>
                <th scope="col" class="px-6 py-1">
                    Phone
                </th>
                <th scope="col" class="px-6 py-1">
                    Address
                </th>
                <th scope="col" class="px-6 py-1">
                    ZIP
                </th>                
                <th scope="col" class="px-6 py-1 w-60 text-left">
                    Gender
                </th>
                <th scope="col" class="px-6 py-1 w-60 truncate">
                    Place of Birth
                </th>
                <th scope="col" class="px-6 py-1 w-60 truncate">
                    Age Status
                </th>
               
                <th scope="col" class="px-6 py-1 w-60 ">
                    Engagement Status
                </th>
               
            </tr>
        </thead>
        <tbody>
        <% @members.each do |member| %>
            <tr class="bg-white border-b hover:bg-gray-100 whitespace-nowrap">
               
                <td class="px-6 py-4 ">
                   <%= link_to member.first_name, club_path(member.club_id), class: link_class %>
                </td>
                
                <td class="px-6 py-4">
                   <%= member.last_name  %>
                </td>
                
                <td class="px-6 py-4">
                   <%= member.city  %>
                </td>

                <td class="px-6 py-4">
                  <%= member.state  %>
                </td>

                <td class="px-6 py-4">
                  <%= member.club_name  %>
                </td>

                <td class="px-6 py-4">
                  <%= member.email  %>
                </td>

                <td class="px-6 py-4">
                  <%= member.phone  %>
                </td>

                <td class="px-6 py-4">
                  <%= member.address  %>
                </td>
                <td class="px-6 py-4">
                  <%= member.zip  %>
                </td>
                <td class="px-6 py-4">
                  <%= member.gender  %>
                </td>
                <td class="px-6 py-4">
                  <%= member.place_of_birth  %>
                </td>
                <td class="px-6 py-4">
                  <%= member.age_status  %>
                </td>
                <td class="px-6 py-4">
                  <%= member.engagement_status  %>
                </td>

                
               
              
            </tr>
        <% end %>
        </tbody>
    </table>
</div>

    <% else %>
        <p class="px-6 py-4">
        No records to view</p>
    <% end %>
<br>



</div>

